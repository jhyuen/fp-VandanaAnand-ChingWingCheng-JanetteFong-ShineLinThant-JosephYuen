<!doctype html>
<html lang="en">
  <head>
    <title>CS4241 Final Project - Knock! Knock!</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet"
          type="text/css"
          href="css/style.css" />
  </head>

  <body>
  <h1 style="position:absolute;top:10%;left:46%;color:white;">Knock Knock!</h1>
    <!-- Login Form -->
    <form class="text-center" id="loginForm" style="color: #757575;position:absolute; top:27%; left:45%;" >
      <div class="col-sm-5" style="position:absolute; top:14%; left:30%;">
        <div class="card">

          <h5 class="card-header info-color white-text text-center py-4">
            <h2 style="color:white;">Sign in</h2>
          </h5>

          <div class="card-body px-lg-5 pt-0">

            <div class="md-form">
              <p style="color:white;">Username:</p>
              <input type="text" id="username" name="user" class="form-control" >
            </div>
            <br>
            <div class="md-form">
              <p style="color:white;">Password:</p>
              <input type="password" id="password" name="password" class="form-control" >
            </div>
            <br>
            <div class="d-flex justify-content-around">
              <div>

              </div>
            </div>
            <br>
            <!-- Sign in button -->
            <button class="btn btn-outline-info btn-rounded btn-block my-4 waves-effect z-depth-0" id="loginButton" >Sign in</button>
            <p style="color:white;">_________________________________</p>
            <!-- Register -->
            <p style="color:white;">Don't have an account?</p>
            <button class="btn btn-outline-info btn-rounded btn-block my-4 waves-effect z-depth-0" id="registerButton">Register</button>
          </div>
        </div>
      </div>
    </form>
  </body>

<script>

  const login = function(e){
    e.preventDefault();

    const username=document.getElementById('username').value,
            password= document.getElementById('password').value;

    const user = {
              'username': username,
              'password' : password
            },
            body = JSON.stringify(user);

    fetch('/login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body
    }).then(function(response){
      if(response.status===200){
        document.getElementById('loginForm').style.display="none";
        document.getElementById('mainForm').style.display="";

      }else{
        //console.log("error")
        window.alert("Username or password not found")
      }

    })
  };

  const submit = function( e ) {
    // prevent default form action from being carried out
    e.preventDefault();

    fetch( '/submit', { //url name = /submit
      method:'POST',
      headers: { 'Content-Type': 'application/json' },

    })
            .then( function( response ) {
              document.getElementById('mainForm').style.display = "";
              document.getElementById('loginForm').style.display ="none"
            });

    return false
  };

  window.onload = function() {
    fetch( '/test', {
      method:'POST',
      credentials: 'include'
    }).then( console.log )
            .catch( err => console.error );
    const button = document.querySelector( '#submitForm' );
    button.onclick = submit;

    const loginBtn = document.querySelector('#loginButton');
    loginBtn.onclick = login

  }

</script>

</html>


